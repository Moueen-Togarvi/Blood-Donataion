{% extends 'main.html' %}
{% load static %}

{% block content %}
<main class="container">
  <div style="max-width: 600px; margin: 4rem auto;">

    <div class="card" style="position: relative; padding: 3rem;">
      <!-- Verified Badge -->
      <span class="badge badge--green"
        style="position: absolute; top: 2rem; right: 2rem; font-size: 1.2rem; border: 1px solid rgba(16, 185, 129, 0.2);">
        Verified Donor
      </span>

      <div style="display: flex; flex-direction: column; align-items: center; text-align: center; gap: 2rem;">

        <!-- Avatar -->
        <div class="avatar"
          style="width: 12rem; height: 12rem; border: 4px solid var(--color-surface); box-shadow: var(--shadow-md);">
          <img src="{% static 'images/avatar.svg' %}" alt="{{user.username}}"
            style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
        </div>

        <!-- Name & Username -->
        <div>
          <h1 style="font-size: 2.8rem; font-weight: 800; color: var(--color-text-main); margin-bottom: 0.5rem;">
            {{user.name|default:user.username}}
          </h1>
          <p style="font-size: 1.6rem; color: var(--color-text-muted);">@{{user.username}}</p>
        </div>

        <!-- Blood Group -->
        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
          <div class="blood-drop"
            style="width: 8rem; height: 8rem; font-size: 2.5rem; border: 3px solid var(--color-primary); background: white;">
            {{user.blood_group}}
          </div>
          <span style="font-size: 1.4rem; font-weight: 600; color: var(--color-text-muted);">Blood Group</span>
        </div>

        <!-- Details List -->
        <div
          style="width: 100%; display: grid; gap: 1.5rem; background: var(--color-bg); padding: 2rem; border-radius: var(--radius-lg); margin-top: 1rem;">

          <!-- Distance -->
          <div style="display: flex; align-items: center; gap: 1.5rem;">
            <div style="background: white; padding: 8px; border-radius: 8px; color: var(--color-primary);">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z" />
              </svg>
            </div>
            <div style="text-align: left;">
              <span style="font-size: 1.2rem; color: var(--color-text-muted); display: block;">Distance from DHQ
                Hospital</span>
              <span style="font-size: 1.6rem; font-weight: 700; color: var(--color-text-main);">
                {% if user.hospital_distance %}{{ user.hospital_distance }}{% else %}Near DHQ Hospital{% endif %}
              </span>
            </div>
          </div>

          <!-- City -->
          <div style="display: flex; align-items: center; gap: 1.5rem;">
            <div style="background: white; padding: 8px; border-radius: 8px; color: var(--color-secondary);">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z" />
              </svg>
            </div>
            <div style="text-align: left;">
              <span style="font-size: 1.2rem; color: var(--color-text-muted); display: block;">City</span>
              <span style="font-size: 1.6rem; font-weight: 700; color: var(--color-text-main);">{{user.city}}</span>
            </div>
          </div>

          <!-- About -->
          {% if user.bio %}
          <div style="border-top: 1px dashed var(--color-border); padding-top: 1.5rem; text-align: left;">
            <span
              style="font-size: 1.4rem; font-weight: 700; color: var(--color-text-main); display: block; margin-bottom: 0.5rem;">About
              Donor</span>
            <p style="font-size: 1.4rem; color: var(--color-text-muted); line-height: 1.6;">{{user.bio}}</p>
          </div>
          {% endif %}
        </div>

        <!-- Contact Actions -->
        <div style="width: 100%; display: flex; flex-direction: column; gap: 1rem;">
          {% if user.phone_number %}
          <a href="tel:{{user.phone_number}}" class="btn btn--primary"
            style="padding: 1.2rem; font-size: 1.6rem; font-weight: 700; border-radius: 5rem; width: 100%;">
            Call Now
          </a>

          <div style="display: flex; gap: 1rem;">
            <button onclick="copyToClipboard('{{user.phone_number}}')" class="btn"
              style="flex: 1; border-radius: 5rem; background: var(--color-surface); border: 2px solid var(--color-border); padding: 1rem;">
              <span style="color: var(--color-primary); margin-right: 5px;">üìû</span>
              <span style="font-weight: 600;">{{user.phone_number}}</span>
            </button>
            {% if user.phone_number_2 %}
            <button onclick="copyToClipboard('{{user.phone_number_2}}')" class="btn"
              style="flex: 1; border-radius: 5rem; background: var(--color-surface); border: 1px dashed var(--color-border); padding: 1rem;">
              <span style="color: var(--color-primary); margin-right: 5px;">üìû</span>
              <span style="font-weight: 600;">{{user.phone_number_2}}</span>
            </button>
            {% endif %}
          </div>
          {% endif %}
        </div>

        {% if request.user == user %}
        <a href="{% url 'update-user' %}" class="btn btn--secondary" style="margin-top: 1rem;">Edit Profile</a>
        {% endif %}

      </div>
    </div>

    <div style="text-align: center; margin-top: 2rem;">
      <a href="{% url 'home' %}" class="btn btn--text">‚Üê Back to Donors</a>
    </div>

  </div>
</main>

<script>
  function copyToClipboard(text) {
    if (!navigator.clipboard) {
      var textArea = document.createElement("textarea");
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      try {
        document.execCommand('copy');
        alert('Number Copied: ' + text);
      } catch (err) {
        console.error('Fallback: Error', err);
      }
      document.body.removeChild(textArea);
      return;
    }
    navigator.clipboard.writeText(text).then(function () {
      alert('Number Copied: ' + text);
    }, function (err) {
      console.error('Async: Could not copy text: ', err);
    });
  }
</script>
{% endblock content %}